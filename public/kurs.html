<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <iframe id="ifr" src="kurs2/scormcontent/index.html" frameborder="0"></iframe>
    <style>
        * {
            margin: 0px;
            padding: 0px;
        }

        body {
            overflow: hidden;
        }

        iframe {
            width: 100vw;
            height: 100vh;
        }
    </style>


    <script>
        /*
      'CommitData',
      'ConcedeControl', // Gives control back to the LMS
      'CreateResponseIdentifier', // Create question response
      'Finish',
      'GetDataChunk',  // Retrieve stringified object with lesson progress
      'GetStatus', // Get Current Status
      'MatchingResponse', // Interaction - Question Type
      'RecordFillInInteraction', // Interaction - Question Type
      'RecordMatchingInteraction', // Interaction - Question Type
      'RecordMultipleChoiceInteraction', // Interaction - Question Type
      'ResetStatus', // Reset the Status
      'SetBookmark',   // Set identifier for bookmark
      'SetDataChunk',  // Set a stringified object with lesson progress
      'SetFailed', // Tell LMS user Failed course
      'SetPassed', // Tell LMS user Passed the course
      'SetReachedEnd', // Tell LMS user completed course
      'SetScore', // Report Users Score to the LMS (for Pass and fail)
      'WriteToDebug',
        */


        let setup = async () => {
            let courseID = null

            fetch("kurs2/imsmanifest.xml").then(async response => {
                let parser = new DOMParser();
                let xmlDoc = parser.parseFromString(await response.text(), "text/xml");
                courseID = xmlDoc.getElementsByTagName("manifest")[0].getAttribute("identifier")
            })


            window.SetDataChunk = (a) => {
                console.log("SetDataChunk:")
                console.log({ courseID, data: JSON.parse(a).d })
                let b = JSON.parse(a).d;

                fetch("api/set-value", {
                    method: "POST",
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        course_id: courseID,
                        user_id: 1,
                        data: JSON.parse(a).d
                    }),
                })
                    .then((response, error) => {
                        console.log(response);
                    })
                    .catch((error) => {
                        console.log(error);
                    })
            };


            window.GetDataChunk = () => {
                let result = null;
                
                const xhttp = new XMLHttpRequest();
                xhttp.onload = function () {
                    console.log("nigger")
                   
                    let data = JSON.parse(this.responseText)

                    result = JSON.stringify({d: data[0].data})
                }
                xhttp.open("GET", "api/get-value/"+courseID+"/1", false);
                xhttp.send();

                return result
            };

            
            window.ConcedeControl = window.history.back;


            console.log(document.getElementById("ifr").contentDocument.title);

        }



        setup();


    </script>
</body>

</html>